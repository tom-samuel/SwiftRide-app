<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passenger Dashboard - SwiftRide</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/map.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <div class="logo-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <span class="logo-text">SwiftRide</span>
            </a>
            
            <div class="nav-content">
                <div class="nav-links">
                    <a href="passenger-dashboard.html" class="nav-link active">Dashboard</a>
                    <a href="ride-history.html" class="nav-link">Ride History</a>
                    <a href="payment-methods.html" class="nav-link">Payment</a>
                    <a href="profile.html" class="nav-link">Profile</a>
                </div>
                
                <div class="nav-actions">
                    <span class="user-welcome">Welcome, Passenger!</span>
                    <a href="index.html" class="btn-secondary">Logout</a>
                </div>
            </div>

            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <div class="dashboard-main">
            <!-- Map Section -->
            <section class="map-section">
                <div class="map-container">
                    <div id="rideMap"></div>
                    <div class="map-controls">
                        <button class="location-btn" onclick="swiftRideMap.centerOnUser()" title="Center on my location">
                            <i class="fas fa-location-arrow"></i>
                        </button>
                        <button class="location-btn" onclick="swiftRideMap.clearRoute()" title="Clear route">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Booking Progress -->
            <div class="booking-progress">
                <div class="progress-step active">
                    <div class="step-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="step-label">Set Locations</div>
                </div>
                <div class="progress-step">
                    <div class="step-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="step-label">Choose Ride</div>
                </div>
                <div class="progress-step">
                    <div class="step-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="step-label">Payment</div>
                </div>
                <div class="progress-step">
                    <div class="step-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="step-label">Confirm</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-grid">
                    <button class="action-btn" onclick="setCurrentLocation('pickup')">
                        <i class="fas fa-map-marker-alt"></i>
                        Current Location
                    </button>
                    <button class="action-btn" onclick="swiftRideMap.showNotification('üéØ Ready to set destination - click on map or use search!', 'info')">
                        <i class="fas fa-flag-checkered"></i>
                        Set Destination
                    </button>
                    <button class="action-btn" onclick="estimateRideFare()">
                        <i class="fas fa-dollar-sign"></i>
                        Estimate Fare
                    </button>
                    <button class="action-btn" onclick="swiftRideMap.clearRoute()">
                        <i class="fas fa-redo"></i>
                        Clear Route
                    </button>
                </div>
            </div>
        </div>

        <div class="dashboard-sidebar">
            <!-- Ride Booking Card -->
            <div class="booking-card">
                <h3>Book Your Ride</h3>
                
                <!-- Location Inputs -->
                <div class="location-inputs">
                    <div class="input-group location-search-container">
                        <label>Pickup Location</label>
                        <div class="input-with-button">
                            <input type="text" id="pickupInput" placeholder="Current location or enter address">
                            <button class="current-location-btn" onclick="setCurrentLocation('pickup')">
                                <i class="fas fa-location-arrow"></i>
                            </button>
                        </div>
                    </div>
                    <div class="input-group location-search-container">
                        <label>Destination</label>
                        <div class="input-with-button">
                            <input type="text" id="destinationInput" placeholder="Where to?">
                            <button class="current-location-btn" onclick="swiftRideMap.showNotification('üìç Select destination on map or search above', 'info')">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ride Estimate (Initially Hidden) -->
                <div id="rideEstimate" class="ride-estimate-card" style="display: none;">
                    <div class="estimate-header">
                        <h4>Estimated Fare</h4>
                        <div class="estimate-price">$15.50</div>
                    </div>
                    <div class="estimate-details">
                        <div class="estimate-detail">
                            <i class="fas fa-clock"></i>
                            <span>15 min</span>
                        </div>
                        <div class="estimate-detail">
                            <i class="fas fa-road"></i>
                            <span>5.2 km</span>
                        </div>
                    </div>
                </div>

                <!-- Ride Options -->
                <div class="ride-options">
                    <h4>Choose Ride Type</h4>
                    <div class="ride-option active" data-type="swift" data-price="12.50">
                        <i class="fas fa-car"></i>
                        <div class="ride-info">
                            <strong>Swift</strong>
                            <span>2 min ‚Ä¢ $12.50</span>
                            <div class="ride-features">
                                <span class="ride-feature">4 seats</span>
                                <span class="ride-feature">AC</span>
                            </div>
                        </div>
                    </div>
                    <div class="ride-option featured" data-type="comfort" data-price="18.75">
                        <div class="featured-badge">Popular</div>
                        <i class="fas fa-car-side"></i>
                        <div class="ride-info">
                            <strong>Comfort</strong>
                            <span>3 min ‚Ä¢ $18.75</span>
                            <div class="ride-features">
                                <span class="ride-feature">4 seats</span>
                                <span class="ride-feature">Extra Space</span>
                                <span class="ride-feature">AC</span>
                            </div>
                        </div>
                    </div>
                    <div class="ride-option" data-type="premium" data-price="24.99">
                        <i class="fas fa-star"></i>
                        <div class="ride-info">
                            <strong>Premium</strong>
                            <span>5 min ‚Ä¢ $24.99</span>
                            <div class="ride-features">
                                <span class="ride-feature">4 seats</span>
                                <span class="ride-feature">Luxury</span>
                                <span class="ride-feature">Priority</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="payment-section">
                    <h4>Payment Method</h4>
                    <div class="payment-methods">
                        <div class="payment-method active" data-method="card">
                            <i class="fas fa-credit-card"></i>
                            <div class="payment-name">Card</div>
                        </div>
                        <div class="payment-method" data-method="paypal">
                            <i class="fab fa-paypal"></i>
                            <div class="payment-name">PayPal</div>
                        </div>
                        <div class="payment-method" data-method="cash">
                            <i class="fas fa-money-bill-wave"></i>
                            <div class="payment-name">Cash</div>
                        </div>
                    </div>
                </div>

                <button class="book-ride-btn" onclick="handleBookRide()">
                    <i class="fas fa-bolt"></i>
                    Book Swift Ride - $12.50
                </button>
            </div>

            <!-- Nearby Drivers -->
            <div class="drivers-card">
                <h3>Nearby Drivers <span class="driver-count">(8 available)</span></h3>
                <div class="drivers-list">
                    <div class="driver-item" data-driver-id="1">
                        <div class="driver-avatar">D1</div>
                        <div class="driver-details">
                            <div class="driver-name">Michael Chen</div>
                            <div class="driver-rating">‚≠ê 4.8 (128 rides)</div>
                            <div class="driver-distance">0.8 km away ‚Ä¢ 2 min</div>
                        </div>
                    </div>
                    <div class="driver-item" data-driver-id="2">
                        <div class="driver-avatar">D2</div>
                        <div class="driver-details">
                            <div class="driver-name">Sarah Johnson</div>
                            <div class="driver-rating">‚≠ê 4.9 (256 rides)</div>
                            <div class="driver-distance">1.2 km away ‚Ä¢ 3 min</div>
                        </div>
                    </div>
                    <div class="driver-item" data-driver-id="3">
                        <div class="driver-avatar">D3</div>
                        <div class="driver-details">
                            <div class="driver-name">David Martinez</div>
                            <div class="driver-rating">‚≠ê 4.7 (89 rides)</div>
                            <div class="driver-distance">0.5 km away ‚Ä¢ 1 min</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Matching Overlay -->
    <div id="matchingOverlay" class="matching-overlay" style="display: none;">
        <div class="matching-content">
            <div class="matching-animation">
                <div class="matching-dot"></div>
                <div class="matching-dot"></div>
                <div class="matching-dot"></div>
            </div>
            <h3>Finding you a driver...</h3>
            <p>Matching you with the best available driver</p>
            <button class="btn-secondary" onclick="cancelMatching()">Cancel</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/app.js"></script>
    <script src="js/map.js"></script>
    <script src="js/location-service.js"></script>
    <script>
        // Enhanced booking functionality
        function handleBookRide() {
            const pickupInput = document.getElementById('pickupInput');
            const destinationInput = document.getElementById('destinationInput');
            
            if (!pickupInput.value || !destinationInput.value) {
                swiftRideMap.showNotification('‚ùå Please set both pickup and destination locations', 'error');
                return;
            }

            showMatchingOverlay();
            
            // Simulate driver matching process
            setTimeout(() => {
                const selectedDriver = Math.floor(Math.random() * 3) + 1;
                confirmDriverMatch(selectedDriver);
            }, 3000);
        }

        function showMatchingOverlay() {
            document.getElementById('matchingOverlay').style.display = 'flex';
        }

        function hideMatchingOverlay() {
            document.getElementById('matchingOverlay').style.display = 'none';
        }

        function cancelMatching() {
            hideMatchingOverlay();
            swiftRideMap.showNotification('‚ùå Ride request cancelled', 'info');
        }

        function confirmDriverMatch(driverId) {
            hideMatchingOverlay();
            const driver = document.querySelector(`[data-driver-id="${driverId}"]`);
            const driverName = driver ? driver.querySelector('.driver-name').textContent : 'a driver';
            
            swiftRideMap.showNotification(`‚úÖ ${driverName} accepted your ride! Arriving in 2-3 minutes.`, 'success');
            
            // Update progress
            updateProgress(3);
        }

        function setCurrentLocation(type) {
            if (navigator.geolocation) {
                swiftRideMap.showNotification('üìç Getting your current location...', 'info');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        if (type === 'pickup') {
                            document.getElementById('pickupInput').value = 'Current Location';
                            swiftRideMap.setPickupLocation([lat, lng]);
                        }
                        
                        swiftRideMap.showNotification('üìç Current location set!', 'success');
                    },
                    (error) => {
                        swiftRideMap.showNotification('‚ùå Could not get your location. Please enable location services.', 'error');
                    }
                );
            } else {
                swiftRideMap.showNotification('‚ùå Geolocation is not supported by your browser', 'error');
            }
        }

        function estimateRideFare() {
            const pickupInput = document.getElementById('pickupInput');
            const destinationInput = document.getElementById('destinationInput');
            
            if (!pickupInput.value || !destinationInput.value) {
                swiftRideMap.showNotification('‚ùå Please set both locations to estimate fare', 'error');
                return;
            }

            // Show estimate card with random fare
            const estimateCard = document.getElementById('rideEstimate');
            const randomFare = (12 + Math.random() * 15).toFixed(2);
            estimateCard.querySelector('.estimate-price').textContent = `$${randomFare}`;
            estimateCard.style.display = 'block';
            
            swiftRideMap.showNotification(`üí∞ Fare estimate: $${randomFare}`, 'success');
            updateProgress(2);
        }

        function updateProgress(step) {
            // Reset all steps
            document.querySelectorAll('.progress-step').forEach((stepEl, index) => {
                stepEl.classList.remove('active');
                if (index < step) {
                    stepEl.classList.add('active');
                }
            });
        }

        // Enhanced ride option selection
        document.querySelectorAll('.ride-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.ride-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                const rideType = this.dataset.type;
                const price = this.dataset.price;
                const button = document.querySelector('.book-ride-btn');
                
                button.innerHTML = `<i class="fas fa-bolt"></i> Book ${rideType.charAt(0).toUpperCase() + rideType.slice(1)} Ride - $${price}`;
                updateProgress(2);
            });
        });

        // Payment method selection
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', function() {
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                this.classList.add('active');
                updateProgress(3);
            });
        });

        // Auto-estimate when both locations are set
        let estimateTimeout;
        const pickupInput = document.getElementById('pickupInput');
        const destinationInput = document.getElementById('destinationInput');

        [pickupInput, destinationInput].forEach(input => {
            input.addEventListener('input', () => {
                clearTimeout(estimateTimeout);
                if (pickupInput.value && destinationInput.value) {
                    estimateTimeout = setTimeout(estimateRideFare, 1000);
                }
            });
        });
    </script>

    <style>
        .matching-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .matching-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-2xl);
            max-width: 400px;
            width: 90%;
        }

        .driver-count {
            font-size: 0.8rem;
            color: var(--gray-600);
            font-weight: normal;
        }
    </style>
</body>
</html>
